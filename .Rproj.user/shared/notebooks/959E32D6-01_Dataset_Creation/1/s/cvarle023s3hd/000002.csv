"0","plots = list()"
"0","state_names = as.character(unique(state$State))"
"0","df_params <- data.frame(matrix(nrow = 51, ncol = 7))"
"0","colnames(df_params) <- c('State', 'p', 'd', 'q', 'P', 'D', 'Q')"
"0","df_excess <- data.frame(matrix(nrow = 51, ncol = 7))"
"0","colnames(df_excess) <- c('State', 'Excess', 'Lower95', 'Upper95', 'Excess_2', 'Lower95_2', 'Upper95_2')"
"0","for (i in seq(1, length(state_names))){"
"0","  state_name = state_names[i]"
"0","  State_data = state %>% filter(State == state_name)"
"0","  State_data[State_data == 'Suppressed'] <- NA"
"0","  State_data$Deaths = as.numeric(levels(State_data$Deaths))[State_data$Deaths]"
"0","  t_State = ts(State_data$Deaths[1:(length(State_data$Deaths) - 18)], start = decimal_date(as.Date(""2015-01-01"")), frequency = 12)"
"0","  "
"0","  parameters = expand.grid(p = seq(0, 1), d = seq(0, 1), q = seq(0, 1),"
"0","              P = seq(0, 1), D = seq(0, 1), Q = seq(0, 1))"
"0","  "
"0","  best_aic = 10000"
"0","  for (j in seq(1, nrow(parameters))){"
"0","    "
"0","    fit <- tryCatch("
"0","    {"
"0","        Arima(t_State, order = c(parameters$p[j], parameters$d[j], parameters$q[j]),"
"0","                      seasonal = c(parameters$P[j], parameters$D[j], parameters$Q[j]), method=""ML"")"
"0","    },"
"0","    error = function(e){"
"0","      "
"0","      tryCatch("
"0","      {"
"0","        Arima(t_State, order = c(1, 1, 0),"
"0","                      seasonal = c(1, 0, 1), method=""ML"")"
"0","      },"
"0","      error = function(e){"
"0","        "
"0","        Arima(t_State, order = c(0, 1, 0),"
"0","                      seasonal = c(1, 0, 0), method=""ML"")"
"0","      }"
"0","      )"
"0","      "
"0","    }"
"0","    )"
"0","    aic = fit[[""aicc""]]"
"0","    if (aic<best_aic){"
"0","      best_aic = aic"
"0","      best_fit = fit"
"0","      best_params = parameters[j, ]"
"0","    }"
"0","  }"
"0",""
"0","  f_fit<-forecast(best_fit, robust = TRUE, h = 18, level = 95)"
"0","  "
"0","  t_State2 = ts(State_data$Deaths[(length(State_data$Deaths) - 17):length(State_data$Deaths)], start = decimal_date(as.Date(""2020-03-01"")), frequency = 12)"
"0","  excess = as.numeric(t_State2) - as.numeric(f_fit[[""mean""]])"
"0","  lower95 = as.numeric(t_State2) - as.numeric(f_fit[[""lower""]])"
"0","  upper95 = as.numeric(t_State2) - as.numeric(f_fit[[""upper""]])"
"0","  "
"0","  excess2 = as.numeric(t_State2)[1:4] - as.numeric(f_fit[[""mean""]])[1:4]"
"0","  lower952 = as.numeric(t_State2)[1:4] - as.numeric(f_fit[[""lower""]])[1:4]"
"0","  upper952 = as.numeric(t_State2)[1:4] - as.numeric(f_fit[[""upper""]])[1:4]"
"0","  "
"0","  df_params[i, ] = c(state_name, best_params$p, best_params$d, best_params$q, best_params$P, best_params$D, best_params$Q)"
"0","  df_excess[i, ] = c(state_name, sum(excess), sum(lower95), sum(upper95), sum(excess2), sum(lower952), sum(upper952))"
"0","  "
"0","model_name = paste('SARIMA(', best_params[1], best_params[2], best_params[3], ')(', best_params[4], best_params[5], best_params[6], ')[12]')"
"0"," g = autoplot(t_State, series=""Data"") + "
"0","     autolayer(fit$fitted, series=model_name) +"
"0","     autolayer(f_fit, series=""Prediction"") +"
"0","     autolayer(t_State2, series = ""True Post-Pandemic"") +"
"0","     xlab(""Year"") + ylab(""Drug Overdose Deaths"") + ggtitle(state_name) + theme_bw()+theme(legend.title = element_blank(),legend.position = ""bottom"")"
"0"," plots[[i]] = g"
"0","}"
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
"2","NAs introduced by coercion"
"2","The non-existent robust arguments will be ignored."
